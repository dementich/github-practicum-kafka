# Как все это работает

1.	Задумка формулируется довольно просто: есть 7 пользователей (Трус, Балбес, Бывалый, Шурик, Нина, Саахов, Дядя), которые могут отправлять сообщения друг другу (в том числе самим себе).

2.	Для каждого из этих пользователей есть список заблокированных пользователей. И пользователи и те, с кем они не хотят общаться, перечислены в файле `users.json`.

3.	Инициализируются черные списки пользователей и цензурируемых слов. С технической точки зрения это выполняется модулем `messages_producer.py` с помощью параметров запуска `--black_list` и `--censored_words`. Пример можно видеть в пункте 7 раздела "Как воспроизвести работу".

4.	В определенный момент времени от случайного пользователя отправляется сообщение в адрес случайного пользователя. Данное сообщение содержит ряд слов, среди которых будет подлежащее цензурированию слово. С технической точки зрения генерация выполняется кодом из `message_producer.py` и сообщение отправляется в топик `messages`. Вместе с этим в топики `black_list` и `censored_words` могут быть отправлены и черные списки отправителей для каждого получателя и список цензурируемых слов (см параметры `messages_producer.py`).

5.	Отправленные сообщения обрабатываются и в случае, если отправитель не входит в черный список получателя, то сообщение идет получателю. При этом все цензурируемые слова заменяются на !!!CENSORED!!!. С технической точки зрения поступившие в топик messages сообщения обрабатываются агентами из модуля `messages_consumer.py`. Они обрабатываются с точки зрения цензуры и, если это допустимо с точки зрения фильтрации отправителей, отправляются в топик `filtered_messages`. Цензурируемые слова можно менять не перезапуская приложение Faust. Достаточно чтобы файл с этими словами содержал открывающую и закрывающую квадратные скобки. При получении такого "списка цензурируемых слов" приложение Faust обнуляет цензурируемые слова, а после этого можно дать отправителю новый список.

# Как воспроизвести работу:

1.	Поднимаем кластер с kafka зайдя в каталог с файлом docker-compose.yaml и запустив команду docker compose -f docker-compose.yaml up -d. Ему надо, чтобы были свободны порты 9094, 9095, 9096, 8088 и 8085.

2.	Создаем топики запустив скрипт `create_topics.sh`

3.	Идем в браузере на 127.0.0.1:8080. Там должен отображаться пользовательский интерфейс kafka-ui и должно быть видно, что у нас 3 брокера

4.	Запускаем обработчик входящих сообщений командой `faust -A messages_consumer worker -l info`

5.	Запускаем генератор цензурируемых исходящих сообщений командой 

```bash
./messages_producer.py --black_list --censored_words ./censored_words.json --message_count 25
```

Для изменения цензурируемых слов можно сначала очистить их список, запустив `./messages_producer --censored_words ./no_censore.json`, а потом запустить продюсер с каким-нибудь новым файлом со списком подлежащих ценрузированию слов.

# Проблемы при работе

Пришлось помучаться с таблицами. В учебных материалах не сказано, что таблица Фауста может не содержать никаких данных при обращении к ней из другого агента. Из-за этого пришлось повозиться с цензурируемыми сообщениями.
